"use strict";(self.webpackChunkdata_centric_zazuko_com=self.webpackChunkdata_centric_zazuko_com||[]).push([[4878],{6079:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"apis/kopflos/how-to/server-side-rendering","title":"Render Web Components on the server","description":"This guide will show you how to serve server-side rendered content with Kopflos.","source":"@site/docs/apis/kopflos/how-to/server-side-rendering.md","sourceDirName":"apis/kopflos/how-to","slug":"/apis/kopflos/how-to/server-side-rendering","permalink":"/docs/apis/kopflos/how-to/server-side-rendering","draft":false,"unlisted":false,"editUrl":"https://github.com/zazuko/data-centric.zazuko.com/tree/main/docs/apis/kopflos/how-to/server-side-rendering.md","tags":[],"version":"current","frontMatter":{},"sidebar":"apisSidebar","previous":{"title":"Seed database on app start","permalink":"/docs/apis/kopflos/how-to/seed-database"},"next":{"title":"Configure SPARQL endpoints","permalink":"/docs/apis/kopflos/how-to/sparql-endpoints"}}');var o=s(4848),r=s(8453);const l={},d="Render Web Components on the server",i={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Loading web components in a page",id:"loading-web-components-in-a-page",level:2},{value:"Preprocessing JS code",id:"preprocessing-js-code",level:2},{value:"Rendering on the server",id:"rendering-on-the-server",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"render-web-components-on-the-server",children:"Render Web Components on the server"})}),"\n",(0,o.jsx)(n.p,{children:"This guide will show you how to serve server-side rendered content with Kopflos."}),"\n",(0,o.jsx)(n.p,{children:"The problem with Web Components is that styles and Shadow DOM which they encapsulate will only be\napplied after the components are loaded. This means that the page will be rendered incomplete at first\nand only finish rendering later. This is known as the flash of unstyled content (FOUC)."}),"\n",(0,o.jsx)(n.p,{children:"By applying server-side rendering, we ensure that the content is available sooner to the user. This\nis especially important for search engine optimization."}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"These features are a work in progress."})}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.p,{children:["First, please make sure to follow the instructions in the ",(0,o.jsx)(n.a,{href:"/docs/apis/kopflos/how-to/html-templates",children:"Getting Started"}),"\nguide."]}),"\n",(0,o.jsx)(n.p,{children:"Then, install the following dependencies:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"npm install @kopflos-cms/vite @kopflos-labs/lit lit\n"})}),"\n",(0,o.jsx)(n.h2,{id:"loading-web-components-in-a-page",children:"Loading web components in a page"}),"\n",(0,o.jsx)(n.p,{children:"Web Components are a powerful way to encapsulate your UI components, making pages dynamic without\nsacrificing the declarative nature of HTML."}),"\n",(0,o.jsxs)(n.p,{children:["Since they are just HTML, Kopflos can render any Web Components in the resulting HTML. However, not\nall Web Components are designed to be rendered on the server. Currently, Kopflos supports rendering\n",(0,o.jsx)(n.a,{href:"https://lit.dev",children:"lit"})," components which follow the\n",(0,o.jsx)(n.a,{href:"https://lit.dev/docs/ssr/authoring/",children:"Authoring components for Lit SSR"})," guide."]}),"\n",(0,o.jsxs)(n.p,{children:["Let's swap some plain HTML with lit components in the ",(0,o.jsx)(n.code,{children:"/templates/page.html"})," file. For the sake of\nan\nexample, these components will mainly encapsulate their styles."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  \x3c!-- Code in head unchanged --\x3e\n</head>\n<body>\n<template target-class="schema:Person">\n  <my-header level="1">{{ valueof schema:name }}</my-header>\n\n  <template property="schema:address">\n    <my-dl>\n      <dt>Street</dt>\n      <dd>{{ valueof schema:streetAddress }}</dd>\n      <dt>City</dt>\n      <dd>{{ valueof schema:addressLocality }}</dd>\n      <dt>Postal Code</dt>\n      <dd>{{ valueof schema:postalCode }}</dd>\n    </my-dl>\n  </template>\n</template>\n\n<script src="/page.js" type="module"><\/script>\n</body>\n</html>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"page.js"}),", we only import the components."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"import './my-header.js';\nimport './my-dl.js';\n"})}),"\n",(0,o.jsx)(n.p,{children:"Below are the components."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// my-header.js\nimport { html, css, LitElement } from 'lit';\n\nclass MyHeader extends LitElement {\n  static get styles () {\n    return css`\n      h1 {\n        color: red;\n      }\n    `;\n  }\n\n  static get properties () {\n    return {\n      level: { type: Number }\n    }\n  };\n\n  render () {\n    switch (this.level) {\n      case 1:\n        return html`<h1><slot></slot></h1>`;\n      case 2:\n        return html`<h2><slot></slot></h2>`;\n      case 3:\n        return html`<h3><slot></slot></h3>`;\n      default:\n        return html`<h4><slot></slot></h4>`;\n    }\n  }\n}\n\ncustomElements.define('my-header', MyHeader);\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// my-dl.js\nimport { html, css, LitElement } from 'lit';\n\nclass MyDl extends LitElement {\n  static get styles () {\n    return css`\n      dl {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 1em;\n      }\n    `;\n  }\n\n  render () {\n    return html`<dl><slot></slot></dl>`;\n  }\n}\n\ncustomElements.define('my-dl', MyDl);\n"})}),"\n",(0,o.jsx)(n.p,{children:"Do refer to lit's documentation for more information on how to create components."}),"\n",(0,o.jsx)(n.h2,{id:"preprocessing-js-code",children:"Preprocessing JS code"}),"\n",(0,o.jsxs)(n.p,{children:["Loaded from installed ",(0,o.jsx)(n.code,{children:"node-modules"}),", Web Components cannot be imported directly in the browser.\nAlso, some components might rely on APIs that are not available in the browser. Kopflos provides the\npackage ",(0,o.jsx)(n.a,{href:"../reference/modules/vite",children:(0,o.jsx)(n.code,{children:"@kopflos-cms/vite"})})," to preprocess the JS code before serving it\nto the browser. It also provides a build functionality to produce optimized code for production."]}),"\n",(0,o.jsxs)(n.p,{children:["To use it, first add a vite plugin following to your ",(0,o.jsx)(n.code,{children:"kopflos.config.js"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"export default {\n  // existing config\n  plugins: {\n    '@kopflos-cms/vite': {\n      root: 'templates',\n      entrypoints: ['templates/*.html'],\n    },\n  },\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Then add a handler to the chain between ",(0,o.jsx)(n.code,{children:"<node:@kopflos-cms/serve-file#default>"})," and\n",(0,o.jsx)(n.code,{children:"<node:@kopflos-labs/handlebars#default>"}),". This handler will preprocess the HTML so that JavaScript\ncode is served by vite."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-turtle",children:'PREFIX sh: <http://www.w3.org/ns/shacl#>\nPREFIX kl: <https://kopflos.described.at/>\nPREFIX code: <https://code.described.at/>\n\n<person-page>\n  # ... abridged\n  kl:handler\n    [\n      a kl:Handler ;\n      kl:method "GET" ;\n      code:implementedBy\n        (\n          [\n            a code:EcmaScriptModule ;\n            code:link <node:@kopflos-cms/serve-file#default> ;\n            code:arguments ( "templates/person.html" ) ;\n          ]\n          [\n            a code:EcmaScriptModule ;\n            code:link <node:@kopflos-cms/vite/template.js#transform> ;\n          ]\n          [\n            a code:EcmaScriptModule ;\n            code:link <node:@kopflos-labs/html-template#default> ;\n            code:arguments\n              (\n                [\n                  a code:EcmaScriptModule ;\n                  code:link <node:@kopflos-labs/handlebars#default> ;\n                ]\n                [\n                  a code:EcmaScriptModule ;\n                  code:link <file:lib/templateData.js#describe> ;\n                ]\n                "/person/${id}"^^code:EcmaScriptTemplateLiteral\n              ) ;\n          ]\n        )\n    ] ;\n.\n'})}),"\n",(0,o.jsx)(n.h2,{id:"rendering-on-the-server",children:"Rendering on the server"}),"\n",(0,o.jsx)(n.p,{children:"Finally, add another handler to the end of the chain."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-turtle",children:'PREFIX sh: <http://www.w3.org/ns/shacl#>\nPREFIX kl: <https://kopflos.described.at/>\nPREFIX code: <https://code.described.at/>\n\n<person-page>\n  # ... abridged\n  kl:handler\n    [\n      a kl:Handler ;\n      kl:method "GET" ;\n      code:implementedBy\n        (\n          # ... abridged\n          [\n            a code:EcmaScriptModule ;\n            code:link <node:@kopflos-labs/lit#ssr> ;\n            code:arguments\n              (\n                [ code:link <file:templates/my-header.js> ; a code:EcmaScriptModule ]\n              )\n          ]\n        )\n    ] ;\n.\n'})}),"\n",(0,o.jsxs)(n.p,{children:["By passing modules to the ",(0,o.jsx)(n.code,{children:"ssr"})," function, Kopflos will render the components on the server. Here, we\nonly ",(0,o.jsx)(n.code,{children:"my-header"}),". The other component ",(0,o.jsx)(n.code,{children:"my-dl"})," will only be running on the client."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var t=s(6540);const o={},r=t.createContext(o);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);