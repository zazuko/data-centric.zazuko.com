"use strict";(self.webpackChunkdata_centric_zazuko_com=self.webpackChunkdata_centric_zazuko_com||[]).push([[544],{4965:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"apis/kopflos/how-to/html-templates","title":"Serve RDF in data-bound HTML","description":"This guide will show you how to serve HTML templates bound to RDF data.","source":"@site/docs/apis/kopflos/how-to/html-templates.md","sourceDirName":"apis/kopflos/how-to","slug":"/apis/kopflos/how-to/html-templates","permalink":"/docs/apis/kopflos/how-to/html-templates","draft":false,"unlisted":false,"editUrl":"https://github.com/zazuko/data-centric.zazuko.com/tree/main/docs/apis/kopflos/how-to/html-templates.md","tags":[],"version":"current","frontMatter":{},"sidebar":"apisSidebar","previous":{"title":"Use express middleware","permalink":"/docs/apis/kopflos/how-to/express-middleware"},"next":{"title":"Load API description","permalink":"/docs/apis/kopflos/how-to/load-api"}}');var s=a(4848),r=a(8453);const l={},o="Serve RDF in data-bound HTML",i={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create a template",id:"create-a-template",level:2},{value:"Create a page resource shape",id:"create-a-page-resource-shape",level:2},{value:"Create a data source",id:"create-a-data-source",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"serve-rdf-in-data-bound-html",children:"Serve RDF in data-bound HTML"})}),"\n",(0,s.jsx)(t.p,{children:"This guide will show you how to serve HTML templates bound to RDF data."}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"These features are a work in progress."})}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(t.p,{children:"In an existing kopflos application, install the following dependencies:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"npm install @kopflos-labs/html-template @kopflos-labs/handlebars\n"})}),"\n",(0,s.jsx)(t.h2,{id:"create-a-template",children:"Create a template"}),"\n",(0,s.jsxs)(t.p,{children:["A template is a combination of HTML ",(0,s.jsx)(t.code,{children:"<template>"})," elements and Handlebars expressions. It is\nimportant,\nhowever, that the HTML is only processed on the server and not in the browser. This is where the\nhandlebars package comes in, providing a familiar syntax to fill in the templates with your data."]}),"\n",(0,s.jsxs)(t.p,{children:["First, create a new HTML file, for example ",(0,s.jsx)(t.code,{children:"/templates/page.html"})," which will be used to serve a page\nwith a title and a body simple. We will be serving instances of the ",(0,s.jsx)(t.code,{children:"schema:Person"})," class."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <template target-class="schema:Person">\n    <template property="schema:name">\n      <title>{{ pointer.value }}</title>\n    </template>\n  </template>\n</head>\n<body>\n<template target-class="schema:Person">\n  <h1>{{ valueof schema:name }}</h1>\n\n  <template property="schema:address">\n    <dl>\n      <dt>Street</dt>\n      <dd>{{ valueof schema:streetAddress }}</dd>\n      <dt>City</dt>\n      <dd>{{ valueof schema:addressLocality }}</dd>\n      <dt>Postal Code</dt>\n      <dd>{{ valueof schema:postalCode }}</dd>\n    </dl>\n  </template>\n</template>\n</body>\n</html>\n'})}),"\n",(0,s.jsx)(t.p,{children:"The template elements are used to find the correct data to fill in the placeholders."}),"\n",(0,s.jsxs)(t.p,{children:["Similarly to ",(0,s.jsxs)(t.a,{href:"https://www.w3.org/TR/shacl/#targetClass",children:["SHACL's ",(0,s.jsx)(t.code,{children:"sh:targetClass"})]}),", the\n",(0,s.jsx)(t.code,{children:"target-class"}),"\nattribute is used to find the root node in the template data. It is required on the top level\ntemplate\nelement."]}),"\n",(0,s.jsxs)(t.p,{children:["Templates with a ",(0,s.jsx)(t.code,{children:"property"})," attribute are used to navigate the data graph, just like\n",(0,s.jsx)(t.a,{href:"https://www.w3.org/TR/shacl/#property-shapes",children:"Property Shapes"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"Inside any template, you can use template binding expressions to fill in the data."}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsx)(t.p,{children:"Here we use handlebars, but it is possible to replace it with other templating languages."})}),"\n",(0,s.jsxs)(t.p,{children:["The current node in the data graph is available as ",(0,s.jsx)(t.code,{children:"pointer"}),". The ",(0,s.jsx)(t.code,{children:"valueof"})," helper is used to output\nvalue of a property, thus being an alternative to nested templates with ",(0,s.jsx)(t.code,{children:"property"})," attributes.\nFor example, since complex properties are supported,"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-html",children:'<img src="{{ valueof schema:image/schema:tumbnail/schema:contentUrl }}">\n'})}),"\n",(0,s.jsx)(t.p,{children:"is a terser equivalent to:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-html",children:'\n<template property="schema:image">\n  <template property="schema:thumbnail">\n    <template property="schema:contentUrl">\n      <img src="{{ pointer.value }}">\n    </template>\n  </template>\n</template>\n'})}),"\n",(0,s.jsx)(t.h2,{id:"create-a-page-resource-shape",children:"Create a page resource shape"}),"\n",(0,s.jsxs)(t.p,{children:["To serve the template, we need to create ",(0,s.jsx)(t.a,{href:"/docs/apis/kopflos/how-to/resource-shape",children:"Resource Shape"})," which will\nact as a dynamic resource, meaning that it will serve resources which do no actually exist in the\nstore. Instead, other resource data will be fetched and the page itself is only a URL pattern. In\nother words, a single resource shape will match and serve multiple resources."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-turtle",children:'PREFIX sh: <http://www.w3.org/ns/shacl#>\nPREFIX kl: <https://kopflos.described.at/>\nPREFIX code: <https://code.described.at/>\n\n<person-page>\n  a kl:ResourceShape ;\n  kl:api <> ;\n  sh:target\n    [\n      a kl:PatternedTarget ;\n      kl:regex "/page/person/(?<id>\\\\w+)$" ;\n    ] ;\n  kl:handler\n    [\n      a kl:Handler ;\n      kl:method "GET" ;\n      code:implementedBy\n        (\n          [\n            a code:EcmaScriptModule ;\n            code:link <node:@kopflos-cms/serve-file#default> ;\n            code:arguments ( "templates/person.html" ) ;\n          ]\n          [\n            a code:EcmaScriptModule ;\n            code:link <node:@kopflos-labs/html-template#default> ;\n            code:arguments\n              (\n                [\n                  a code:EcmaScriptModule ;\n                  code:link <node:@kopflos-labs/handlebars#default> ;\n                ]\n                [\n                  a code:EcmaScriptModule ;\n                  code:link <file:lib/templateData.js#describe> ;\n                ]\n                "/person/${id}"^^code:EcmaScriptTemplateLiteral\n              ) ;\n          ]\n        )\n    ] ;\n.\n'})}),"\n",(0,s.jsxs)(t.p,{children:["The patterned target is used to match the URL pattern similar to ",(0,s.jsx)(t.code,{children:"/page/person/:id"})," where ",(0,s.jsx)(t.code,{children:":id"})," is\nstored as a ",(0,s.jsx)(t.a,{href:"../reference/request-handlers#subject-variables",children:"request subject variable"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["The handler is a sequence of modules which will load the template file using ",(0,s.jsx)(t.code,{children:"@kopflos-cms/serve-file"}),"\nand the process the templates using ",(0,s.jsx)(t.code,{children:"@kopflos-labs/html-template"})," and ",(0,s.jsx)(t.code,{children:"@kopflos-labs/handlebars"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"create-a-data-source",children:"Create a data source"}),"\n",(0,s.jsxs)(t.p,{children:["Finally, you need to create the ",(0,s.jsx)(t.code,{children:"lib/templateData.js#describe"})," module which will provide the data\nfor the template:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import type { TemplateDataFunc } from '@kopflos-labs/html-template'\n\nexport const describe = (resourcePath: string): TemplateDataFunc => ({ env }) => {\n  return env.sparql.default.stream.query.construct(`\nBASE <${env.kopflos.config.baseIri}>\nDESCRIBE <${resourcePath}>`)\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The implementation is a minimal query to describe the person resource, whose identifier is taken from\nthe resource pattern. Notice how it's declaratively set in the handler as a template literal and\nforwarded to the ",(0,s.jsx)(t.code,{children:"describe"})," function."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>l,x:()=>o});var n=a(6540);const s={},r=n.createContext(s);function l(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);