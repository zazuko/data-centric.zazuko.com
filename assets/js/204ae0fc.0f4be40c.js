"use strict";(self.webpackChunkdata_centric_zazuko_com=self.webpackChunkdata_centric_zazuko_com||[]).push([[2754],{1768:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"apis/kopflos/how-to/express-middleware","title":"Use express middleware","description":"The package @kopflos-cms/express allows you to use existing express middleware in your Kopflos project.","source":"@site/docs/apis/kopflos/how-to/express-middleware.md","sourceDirName":"apis/kopflos/how-to","slug":"/apis/kopflos/how-to/express-middleware","permalink":"/docs/apis/kopflos/how-to/express-middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/zazuko/data-centric.zazuko.com/tree/main/docs/apis/kopflos/how-to/express-middleware.md","tags":[],"version":"current","frontMatter":{},"sidebar":"apisSidebar","previous":{"title":"Getting started","permalink":"/docs/apis/kopflos/tutorials/gettings-started"},"next":{"title":"Serve RDF in data-bound HTML","permalink":"/docs/apis/kopflos/how-to/html-templates"}}');var r=n(4848),t=n(8453);const a={},i="Use express middleware",d={},l=[{value:"Middleware from NPM packages",id:"middleware-from-npm-packages",level:2},{value:"Your own middleware or NPM packages which do not export a function",id:"your-own-middleware-or-npm-packages-which-do-not-export-a-function",level:2}];function c(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"use-express-middleware",children:"Use express middleware"})}),"\n",(0,r.jsxs)(o.p,{children:["The package ",(0,r.jsx)(o.code,{children:"@kopflos-cms/express"})," allows you to use existing express middleware in your Kopflos project.\nTo do that, add a plugin ",(0,r.jsx)(o.code,{children:"@kopflos-cms/express/middleware"})," to your ",(0,r.jsx)(o.code,{children:"kopflos.config.js"})," file with ",(0,r.jsx)(o.code,{children:"before"}),"\nand ",(0,r.jsx)(o.code,{children:"after"})," keys."]}),"\n",(0,r.jsxs)(o.p,{children:["The ",(0,r.jsx)(o.code,{children:"after"})," middleware are only executed when kopflos handler returns a ",(0,r.jsx)(o.code,{children:"404"})," status code or throws an error."]}),"\n",(0,r.jsx)(o.h2,{id:"middleware-from-npm-packages",children:"Middleware from NPM packages"}),"\n",(0,r.jsxs)(o.p,{children:["In your ",(0,r.jsx)(o.code,{children:"kopflos.config.js"})," file, you can add references to other modules, such as ",(0,r.jsx)(o.code,{children:"cors"})," or ",(0,r.jsx)(o.code,{children:"compression"}),"."]}),"\n",(0,r.jsx)(o.p,{children:"The requirements are that every such module default-exports a function which returns the actual middleware."}),"\n",(0,r.jsxs)(o.p,{children:["To provide an additional config, add a two element array instead of just the module name, as shown below\non the example of ",(0,r.jsx)(o.code,{children:"compression"}),"."]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-javascript",children:"export default {\n  // ...other settings\n  plugins: {\n    '@kopflos-cms/express/middleware': {\n      before: [\n        'cors',      \n        ['compression', { level: 9 }],\n      ],\n    },\n  },\n}\n"})}),"\n",(0,r.jsxs)(o.p,{children:["You can also reference named exports by adding a ",(0,r.jsx)(o.code,{children:"#name"})," after the modue name. For example,\nto use ",(0,r.jsx)(o.a,{href:"https://www.npmjs.com/package/express-rate-limit",children:"express-rate-limit"}),", you can do the following:"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-javascript",children:"export default {\n  // ...other settings\n  plugins: {\n    '@kopflos-cms/express/middleware': {\n      before: [\n        ['express-rate-limit#rateLimit', {\n          windowMs: 15 * 60 * 1000,\n          limit: 100,\n        }],      \n      ],\n    },\n  },\n}\n"})}),"\n",(0,r.jsx)(o.h2,{id:"your-own-middleware-or-npm-packages-which-do-not-export-a-function",children:"Your own middleware or NPM packages which do not export a function"}),"\n",(0,r.jsx)(o.p,{children:"If you want to include your own middleware or a package which does not export a function, you can do so by\nexporting a function from your own module."}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-js",children:"// ./lib/my-middleware.js\nexport default function myMiddleware() {\n  return (req, res, next) => {\n    // your middleware code here\n    next();\n  };\n}\n"})}),"\n",(0,r.jsxs)(o.p,{children:["Then, you can reference it in your ",(0,r.jsx)(o.code,{children:"kopflos.config.js"})," file by the absolute path:"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-javascript",children:"import * as url from 'node:url'\n\nexport default {\n  // ...other settings\n  plugins: {\n    '@kopflos-cms/express/middleware': {\n      before: [\n        url.fileURLToPath(new URL('./lib/my-middleware.js', import.meta.url)),\n      ],\n    },\n  },\n}\n"})}),"\n",(0,r.jsx)(o.admonition,{type:"warning",children:(0,r.jsxs)(o.p,{children:["The path must be absolute, thus the usage of ",(0,r.jsx)(o.code,{children:"import.meta.url"})," to resolve the path relative to the\nconfig file itself. For that reason, this method will only work with configuration files written as\ncode. (for commonjs, you can use ",(0,r.jsx)(o.code,{children:"__dirname"})," instead)"]})})]})}function p(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>a,x:()=>i});var s=n(6540);const r={},t=s.createContext(r);function a(e){const o=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(t.Provider,{value:o},e.children)}}}]);