"use strict";(self.webpackChunkdata_centric_zazuko_com=self.webpackChunkdata_centric_zazuko_com||[]).push([[6470],{7647:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>t,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"apis/kopflos/how-to/resource-loaders","title":"Configure resource loaders","description":"As explained on the Request pipeline page, early in the request pipeline, Kopflos selects a resource loader to load the requested resource\'s Core Representation.","source":"@site/docs/apis/kopflos/how-to/resource-loaders.md","sourceDirName":"apis/kopflos/how-to","slug":"/apis/kopflos/how-to/resource-loaders","permalink":"/docs/apis/kopflos/how-to/resource-loaders","draft":false,"unlisted":false,"editUrl":"https://github.com/zazuko/data-centric.zazuko.com/tree/main/docs/apis/kopflos/how-to/resource-loaders.md","tags":[],"version":"current","frontMatter":{},"sidebar":"apisSidebar","previous":{"title":"Serve virtual resources","permalink":"/docs/apis/kopflos/how-to/patterned-target"},"next":{"title":"Select which resources should be served by the API","permalink":"/docs/apis/kopflos/how-to/resource-shape"}}');var n=r(4848),a=r(8453);const l={},d="Configure resource loaders",t={},c=[{value:"Predefined loaders",id:"predefined-loaders",level:2},{value:"Own graph loader",id:"own-graph-loader",level:3},{value:"<code>DESCRIBE</code> loader",id:"describe-loader",level:3},{value:"Loader precedence",id:"loader-precedence",level:2},{value:"Implementing and using custom Resource Loaders",id:"implementing-and-using-custom-resource-loaders",level:2}];function i(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"configure-resource-loaders",children:"Configure resource loaders"})}),"\n",(0,n.jsxs)(o.p,{children:["As explained on the ",(0,n.jsx)(o.a,{href:"/docs/apis/kopflos/explanations/request-pipeline",children:"Request pipeline page"}),", early in the request pipeline, Kopflos selects a resource loader to load the requested resource's Core Representation."]}),"\n",(0,n.jsxs)(o.p,{children:["Resource Loaders can be declared on instances of ",(0,n.jsx)(o.code,{children:"kopflos:ResourceShape"}),", ",(0,n.jsx)(o.code,{children:"kopflos:Api"}),", and ",(0,n.jsx)(o.code,{children:"kopflos:Config"})," resources."]}),"\n",(0,n.jsx)(o.h2,{id:"predefined-loaders",children:"Predefined loaders"}),"\n",(0,n.jsx)(o.p,{children:"Kopflos recognizes two loaders out of the box. They are identified by their shorthand identifiers."}),"\n",(0,n.jsx)(o.h3,{id:"own-graph-loader",children:"Own graph loader"}),"\n",(0,n.jsxs)(o.p,{children:['The "Own Graph" loader is the default.\nIt loads the named graph for the requested resource.\nFor example,\na request to ',(0,n.jsx)(o.code,{children:"https://example.org/person/1"})," will load the entire named graph ",(0,n.jsx)(o.code,{children:"https://example.org/person/1"})," as Core Representation."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-turtle",children:"PREFIX kopflos: <https://kopflos.described.at/>\n\n<>\n  # a kopflos:ResourceShape ; # or\n  # a kopflos:Api ;           # or \n  # a kopflos:Config ;\n  kopflos:resourceLoader kopflos:OwnGraphLoader ;\n.\n"})}),"\n",(0,n.jsxs)(o.h3,{id:"describe-loader",children:[(0,n.jsx)(o.code,{children:"DESCRIBE"})," loader"]}),"\n",(0,n.jsxs)(o.p,{children:["The ",(0,n.jsx)(o.code,{children:"DESCRIBE"})," loader is a built-in loader\nthat uses the SPARQL ",(0,n.jsx)(o.code,{children:"DESCRIBE"})," query to load the requested resource.\nThe loader will issue a ",(0,n.jsx)(o.code,{children:"DESCRIBE"})," query to the default SPARQL endpoint."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-turtle",children:"PREFIX kopflos: <https://kopflos.described.at/>\n\n<>\n  # a kopflos:ResourceShape ; # or\n  # a kopflos:Api ;           # or \n  # a kopflos:Config ;\n  kopflos:resourceLoader kopflos:DescribeLoader ;\n.\n"})}),"\n",(0,n.jsx)(o.h2,{id:"loader-precedence",children:"Loader precedence"}),"\n",(0,n.jsxs)(o.p,{children:["Kopflos selects a loader based on the ",(0,n.jsx)(o.code,{children:"kopflos:resourceLoader"})," property,\ngoing bottom-up from the Resource Shape to the shared ",(0,n.jsx)(o.code,{children:"kopflos:Config"})," resource."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-turtle",children:"PREFIX sh: <http://www.w3.org/ns/shacl#>\nPREFIX kopflos: <https://kopflos.described.at/>\nPREFIX ex: <http://example.org/>\n\nex:PersonShape\n  a kopflos:ResourceShape ;\n  kopflos:api ex:PeopleApi ;\n  sh:targetNode ex:Person ;\n  kopflos:resourceLoader ex:ResourceLoader1 ;\n.\n\nex:AddressShape\n  a kopflos:ResourceShape ;\n  kopflos:api ex:PeopleApi ;\n  sh:targetNode ex:Person ;\n.\n\nex:PeopleApi\n  a kopflos:Api ;\n  kopflos:config ex:Config ;\n  kopflos:resourceLoader ex:ResourceLoader2 ;\n.\n\nex:ArticleShape\n  kopflos:api ex:PublishingApi ;\n  sh:targetNode ex:Article ;\n.\n\nex:PublishingApi\n  a kopflos:Api ;\n  kopflos:config ex:Config ;\n.\n\nex:Config\n  a kopflos:Config ;\n  kopflos:resourceLoader ex:ResourceLoader3 ;\n.\n"})}),"\n",(0,n.jsx)(o.p,{children:"The algorithm is straightforward. For any given matched resource shape, Kopflos will:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Check if the resource shape has a ",(0,n.jsx)(o.code,{children:"kopflos:resourceLoader"})," property. If it does, Kopflos will use the loader specified in the property."]}),"\n",(0,n.jsxs)(o.li,{children:["If the resource shape does not have a ",(0,n.jsx)(o.code,{children:"kopflos:resourceLoader"})," property, Kopflos will look for the ",(0,n.jsx)(o.code,{children:"kopflos:resourceLoader"})," property in the resource's API resource."]}),"\n",(0,n.jsxs)(o.li,{children:["If the API resource does not have a ",(0,n.jsx)(o.code,{children:"kopflos:resourceLoader"})," property, Kopflos will look for the ",(0,n.jsx)(o.code,{children:"kopflos:resourceLoader"})," property in the linked ",(0,n.jsx)(o.code,{children:"kopflos:Config"})," resource."]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"In the example above:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["If a requested resource matches the ",(0,n.jsx)(o.code,{children:"ex:PersonShape"}),", Kopflos will use ",(0,n.jsx)(o.code,{children:"ex:ResourceLoader1"})," from the resource shape itself."]}),"\n",(0,n.jsxs)(o.li,{children:["If a requested resource matches the ",(0,n.jsx)(o.code,{children:"ex:AddressShape"}),", Kopflos will use ",(0,n.jsx)(o.code,{children:"ex:ResourceLoader2"})," from the API resource."]}),"\n",(0,n.jsxs)(o.li,{children:["If a requested resource matches the ",(0,n.jsx)(o.code,{children:"ex:ArticleShape"}),", Kopflos will use ",(0,n.jsx)(o.code,{children:"ex:ResourceLoader3"})," from the Config resource."]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"implementing-and-using-custom-resource-loaders",children:"Implementing and using custom Resource Loaders"}),"\n",(0,n.jsxs)(o.p,{children:["A loader is a function that takes the requested URI\n(in the form of a ",(0,n.jsx)(o.a,{href:"https://rdf.js.org/data-model-spec/#namednode-interface",children:"NamedNode"}),")\nand returns a Core Representation as an ",(0,n.jsx)(o.a,{href:"https://rdf.js.org/stream-spec/#stream-interface",children:"RDF/JS Stream"}),".\nIt also takes a second argument: the instance of Kopflos that is processing the request."]}),"\n",(0,n.jsx)(o.p,{children:"For example, here is a loader which sends a request query to a Stardog database,\nwith a query hint to ensure that the Concise Bounded Description (CBD) is returned."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-ts",children:"// src/resource-loaders/stardog-loaders.ts\nimport type { ResourceLoader } from '@kopflos-cms/core'\n\nexport const CBD: ResourceLoader = async (uri, kopflos) => {\n  const query = `\n#pragma describe.strategy cbd  \nDESCRIBE <${uri.value}>`\n  \n  return kopflos.env.sparql.default.stream.query.construct(query)\n}\n"})}),"\n",(0,n.jsx)(o.p,{children:"To use it as the default in an API, declare the loader in the API's configuration:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-turtle",children:"PREFIX code: <https://cube.link/code#>\nPREFIX kopflos: <https://kopflos.described.at/>\nPREFIX ex: <http://example.org/>\n\nex:Config\n  a kopflos:Config ;\n  kopflos:resourceLoader\n    [\n      a code:EcmaScriptModule ;\n      code:link <file:src/resource-loaders/stardog-loaders.js#CBD> ;\n    ] ;\n.\n"})})]})}function p(e={}){const{wrapper:o}={...(0,a.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(i,{...e})}):i(e)}},8453:(e,o,r)=>{r.d(o,{R:()=>l,x:()=>d});var s=r(6540);const n={},a=s.createContext(n);function l(e){const o=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),s.createElement(a.Provider,{value:o},e.children)}}}]);